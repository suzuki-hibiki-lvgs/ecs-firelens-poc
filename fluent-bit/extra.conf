# ===========================================
# Fluent Bit Extra Configuration for FireLens
# ===========================================
# FireLensが/fluent-bit/etc/fluent-bit.confを予約しているため、
# カスタム設定は別パス（/extra.conf）に配置する必要がある。
# INPUTセクションはFireLensが自動追加するため記述しない。

# -------------------------------------------
# OUTPUT: Kinesis Firehose (全ログ → S3)
# -------------------------------------------
# コンプライアンス対応のため全量をS3に保存
[OUTPUT]
    Name              kinesis_firehose
    Match             *
    region            ${AWS_REGION}
    delivery_stream   ${FIREHOSE_DELIVERY_STREAM}
    time_key          timestamp
    time_key_format   %Y-%m-%dT%H:%M:%S.%LZ

# -------------------------------------------
# OUTPUT: New Relic (全ログ)
# -------------------------------------------
# nrlogsプラグインの設定
# 許可されるプロパティ: base_uri, api_key, license_key, compress
[OUTPUT]
    Name              nrlogs
    Match             *-firelens-*
    license_key       ${NEW_RELIC_LICENSE_KEY}
    base_uri          https://log-api.newrelic.com/log/v1
    compress          gzip
